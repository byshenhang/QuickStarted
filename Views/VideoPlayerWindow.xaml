<Window
    x:Class="QuickStarted.Views.VideoPlayerWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="{Binding VideoTitle}"
    Width="900"
    Height="600"
    MinWidth="600"
    MinHeight="400"
    Background="#FF1E1E1E"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <Window.Resources>
        <!-- 转换器 -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!--  控制按钮样式  -->
        <Style x:Key="ControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="8" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Padding="{TemplateBinding Padding}"
                            Background="{TemplateBinding Background}"
                            CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#44FFFFFF" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#66FFFFFF" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  进度条样式  -->
        <Style x:Key="VideoSliderStyle" TargetType="Slider">
            <Setter Property="Background" Value="#44FFFFFF" />
            <Setter Property="Foreground" Value="#4FC3F7" />
            <Setter Property="Height" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  视频播放区域  -->
        <Border
            Grid.Row="0"
            Margin="10,10,10,5"
            Background="Black">
            <Grid>
                <!--  MediaElement 视频播放器  -->
                <MediaElement
                    x:Name="VideoPlayer"
                    LoadedBehavior="Manual"
                    MediaEnded="VideoPlayer_MediaEnded"
                    MediaFailed="VideoPlayer_MediaFailed"
                    MediaOpened="VideoPlayer_MediaOpened"
                    Source="{Binding VideoSource}"
                    Stretch="Uniform"
                    UnloadedBehavior="Manual" />

                <!--  加载指示器  -->
                <Border Background="#AA000000" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="32"
                            Foreground="White"
                            Text="⏳" />
                        <TextBlock
                            Margin="0,10,0,0"
                            HorizontalAlignment="Center"
                            FontSize="16"
                            Foreground="White"
                            Text="加载中..." />
                    </StackPanel>
                </Border>

                <!--  错误提示  -->
                <Border Background="#AA000000" Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="32"
                            Foreground="Red"
                            Text="❌" />
                        <TextBlock
                            Margin="0,10,0,0"
                            HorizontalAlignment="Center"
                            FontSize="16"
                            Foreground="White"
                            Text="{Binding ErrorMessage}"
                            TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!--  控制面板  -->
        <Border
            Grid.Row="1"
            Margin="10,0,10,10"
            Padding="15,10"
            Background="#FF2D2D2D">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  进度条  -->
                <Grid Grid.Row="0" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Column="0"
                        Margin="0,0,10,0"
                        VerticalAlignment="Center"
                        FontSize="12"
                        Foreground="White"
                        Text="{Binding CurrentTimeText}" />

                    <Slider
                        x:Name="ProgressSlider"
                        Grid.Column="1"
                        Maximum="{Binding TotalSeconds}"
                        Minimum="0"
                        PreviewMouseLeftButtonDown="ProgressSlider_PreviewMouseLeftButtonDown"
                        PreviewMouseLeftButtonUp="ProgressSlider_PreviewMouseLeftButtonUp"
                        Style="{StaticResource VideoSliderStyle}"
                        ValueChanged="ProgressSlider_ValueChanged"
                        Value="{Binding CurrentSeconds}" />

                    <TextBlock
                        Grid.Column="2"
                        Margin="10,0,0,0"
                        VerticalAlignment="Center"
                        FontSize="12"
                        Foreground="White"
                        Text="{Binding TotalTimeText}" />
                </Grid>

                <!--  控制按钮  -->
                <StackPanel
                    Grid.Row="1"
                    HorizontalAlignment="Center"
                    Orientation="Horizontal">

                    <Button
                        Click="PlayPause_Click"
                        Style="{StaticResource ControlButtonStyle}"
                        ToolTip="播放/暂停">
                        <TextBlock FontSize="16" Text="{Binding PlayPauseIcon}" />
                    </Button>

                    <Button
                        Click="Stop_Click"
                        Style="{StaticResource ControlButtonStyle}"
                        ToolTip="停止">
                        <TextBlock FontSize="14" Text="⏹" />
                    </Button>

                    <Separator Width="20" Background="Transparent" />

                    <TextBlock
                        Margin="0,0,5,0"
                        VerticalAlignment="Center"
                        Foreground="White"
                        Text="音量:" />

                    <Slider
                        x:Name="VolumeSlider"
                        Width="80"
                        VerticalAlignment="Center"
                        Maximum="1"
                        Minimum="0"
                        ValueChanged="VolumeSlider_ValueChanged"
                        Value="{Binding Volume}" />

                    <Separator Width="20" Background="Transparent" />

                    <Button
                        Click="FullScreen_Click"
                        Style="{StaticResource ControlButtonStyle}"
                        ToolTip="全屏">
                        <TextBlock FontSize="14" Text="⛶" />
                    </Button>

                    <Button
                        Click="Close_Click"
                        Style="{StaticResource ControlButtonStyle}"
                        ToolTip="关闭">
                        <TextBlock FontSize="14" Text="✕" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>